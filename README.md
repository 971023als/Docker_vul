# Docker 환경 진단 스크립트

## 설명
이 Bash 스크립트는 Docker 컨테이너가 호스트 OS의 주요 자원에 접근하는 것을 진단하고, 이를 제한하기 위한 설정 방법을 제안합니다. 해당 스크립트는 보안 관점에서 컨테이너와 호스트 간의 자원 접근을 검토하여 보안 상태를 평가합니다.

---

## 주요 기능
1. **호스트 OS 주요 디렉터리 마운트 검사**:
   - Docker 컨테이너에서 호스트의 중요 디렉터리가 마운트되었는지 확인합니다.
2. **호스트 장치 파일 노출 검사**:
   - Docker 컨테이너가 호스트 장치 파일에 직접 접근하는지 검사합니다.
3. **진단 결과 출력**:
   - 검사 결과를 JSON 형식으로 출력하며, 이를 기반으로 취약 여부를 평가합니다.
4. **대응 방안 제시**:
   - 보안 강화를 위한 설정 방법을 JSON 형식으로 제공합니다.

---

## 요구 사항

1. **운영 체제**:
   - Linux 기반 운영 체제에서 실행 가능 (Bash 환경 필요).

2. **Docker**:
   - Docker가 설치되어 있어야 하며, 관리자 권한으로 실행할 수 있어야 합니다.

3. **Docker 컨테이너**:
   - 진단 대상이 되는 Docker 컨테이너가 실행 중이거나 정지 상태여야 합니다.

---

## 사용 방법

### 1. 스크립트 실행
```bash
bash docker_configuration_diagnostic.sh
```

### 2. 실행 결과
스크립트를 실행하면 다음과 같은 JSON 형식의 결과를 출력합니다:

```json
{
  "분류": "Docker Configuration",
  "코드": "1.1",
  "위험도": "중요도 상",
  "진단_항목": "호스트 OS 주요 자원 접근 제어",
  "대응방안": {
    "설명": "컨테이너에서 호스트 OS의 주요 자원에 접근하는 것을 제한하여 호스트 및 다른 컨테이너의 안정성과 보안을 보장합니다. 주요 시스템 디렉터리 마운트와 호스트 장치 파일의 직접 노출을 금지합니다.",
    "설정방법": [
      "주요 시스템 디렉터리 마운트 금지: 컨테이너 생성 시 호스트의 중요 시스템 디렉터리를 마운트 하지 않도록 설정합니다.",
      "호스트 장치 파일 컨테이너에 직접 노출 금지: 컨테이너에 필요한 호스트 장치 파일만 노출하고, 적절한 권한 설정을 통해 접근을 제어합니다."
    ]
  },
  "현황": [],
  "진단_결과": "양호"
}
```

### 3. 진단 결과 확인
- `현황`에는 각 컨테이너의 마운트된 디렉터리 및 장치 파일 정보가 출력됩니다.
- `진단_결과`는 검사 결과에 따라 `양호` 또는 `취약`으로 표시됩니다.

---

## 디버깅 가이드

### 1. 진단 결과가 "취약"으로 표시되는 경우
- **문제**: 컨테이너가 호스트의 주요 디렉터리나 장치 파일에 접근 중.
- **해결 방법**:
  - 컨테이너 실행 시 `--volume` 옵션을 사용하여 민감한 디렉터리를 마운트하지 않도록 설정합니다.
  - 컨테이너 실행 시 `--device` 옵션으로 노출되는 장치 파일을 제한합니다.

### 2. Docker 명령어 실행 오류
- **문제**: Docker 명령어가 실행되지 않음.
- **해결 방법**:
  - Docker가 설치되어 있는지 확인.
  - 사용자 계정이 `docker` 그룹에 속해 있는지 확인.

### 3. JSON 결과 출력 오류
- **문제**: JSON 형식이 깨지거나 출력되지 않음.
- **해결 방법**:
  - 스크립트 내 변수 값이 잘못 설정되었는지 확인.
  - 각 검사 결과가 적절히 배열에 추가되었는지 확인.

---

## 사용 예시

1. **양호 결과**:
   ```json
   {
     "분류": "Docker Configuration",
     "코드": "1.1",
     "위험도": "중요도 상",
     "진단_항목": "호스트 OS 주요 자원 접근 제어",
     "대응방안": {
       "설명": "컨테이너에서 호스트 OS의 주요 자원에 접근하는 것을 제한하여 호스트 및 다른 컨테이너의 안정성과 보안을 보장합니다. 주요 시스템 디렉터리 마운트와 호스트 장치 파일의 직접 노출을 금지합니다.",
       "설정방법": [
         "주요 시스템 디렉터리 마운트 금지: 컨테이너 생성 시 호스트의 중요 시스템 디렉터리를 마운트 하지 않도록 설정합니다.",
         "호스트 장치 파일 컨테이너에 직접 노출 금지: 컨테이너에 필요한 호스트 장치 파일만 노출하고, 적절한 권한 설정을 통해 접근을 제어합니다."
       ]
     },
     "현황": [],
     "진단_결과": "양호"
   }
   ```

2. **취약 결과**:
   ```json
   {
     "분류": "Docker Configuration",
     "코드": "1.1",
     "위험도": "중요도 상",
     "진단_항목": "호스트 OS 주요 자원 접근 제어",
     "대응방안": {
       "설명": "컨테이너에서 호스트 OS의 주요 자원에 접근하는 것을 제한하여 호스트 및 다른 컨테이너의 안정성과 보안을 보장합니다. 주요 시스템 디렉터리 마운트와 호스트 장치 파일의 직접 노출을 금지합니다.",
       "설정방법": [
         "주요 시스템 디렉터리 마운트 금지: 컨테이너 생성 시 호스트의 중요 시스템 디렉터리를 마운트 하지 않도록 설정합니다.",
         "호스트 장치 파일 컨테이너에 직접 노출 금지: 컨테이너에 필요한 호스트 장치 파일만 노출하고, 적절한 권한 설정을 통해 접근을 제어합니다."
       ]
     },
     "현황": [
       {
         "컨테이너 ID": "xxxxxxxx",
         "Volumes": "/etc:/etc",
         "Devices": "/dev/sda:/dev/sda"
       }
     ],
     "진단_결과": "취약"
   }
   ```

---

## 주의 사항

1. 스크립트는 Docker 컨테이너가 실행 중일 때만 유효한 결과를 제공합니다.
2. 민감한 데이터가 포함된 결과를 공유하기 전에 필터링해야 합니다.
3. 스크립트를 실행하기 전에 관리자 권한으로 실행해야 합니다.

---

## 기여
- 개선점이나 버그는 Pull Request 또는 Issue를 통해 알려주세요.

