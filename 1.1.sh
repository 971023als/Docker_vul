#!/bin/bash

# Variables initialization
분류="Docker Configuration"
코드="1.1"
위험도="중요도 상"
진단_항목="호스트 OS 주요 자원 접근 제어"
대응방안="{
  \"설명\": \"컨테이너에서 호스트 OS의 주요 자원에 접근하는 것을 제한하여 호스트 및 다른 컨테이너의 안정성과 보안을 보장합니다. 주요 시스템 디렉터리 마운트와 호스트 장치 파일의 직접 노출을 금지합니다.\",
  \"설정방법\": [
    \"주요 시스템 디렉터리 마운트 금지: 컨테이너 생성 시 호스트의 중요 시스템 디렉터리를 마운트 하지 않도록 설정합니다.\",
    \"호스트 장치 파일 컨테이너에 직접 노출 금지: 컨테이너에 필요한 호스트 장치 파일만 노출하고, 적절한 권한 설정을 통해 접근을 제어합니다.\"
  ]
}"
현황=()
진단_결과=""

# 진단 시작
echo "진단 시작..."
# Check mounted directories and permissions
echo "검사: 호스트 OS 주요 시스템 디렉터리 마운트 금지"
docker ps --quiet --all | xargs docker inspect --format '{{ .Id }}: Volumes={{ .Mounts }}'

echo "검사: 호스트 장치 파일 컨테이너에 직접 노출 금지"
docker ps --quiet --all | xargs docker inspect --format '{{ .Id }}: Devices={{ .HostConfig.Devices }}'

# 임시 진단 결과 할당
진단_결과="양호" # 또는 "취약"을 할당할 수 있습니다. 검사 후 결정

# 결과 JSON 출력
echo "{
  \"분류\": \"$분류\",
  \"코드\": \"$코드\",
  \"위험도\": \"$위험도\",
  \"진단_항목\": \"$진단_항목\",
  \"대응방안\": $대응방안,
  \"현황\": $현황,
  \"진단_결과\": \"$진단_결과\"
}"
