#!/bin/bash

# 변수 초기화
{
  "분류": "Docker Swarm",
  "코드": "4.1",
  "위험도": "중요도 상",
  "진단_항목": "인증 제어",
  "대응방안": {
    "설명": "Docker Swarm 모드에서는 manager node와 worker node가 있으며, 인증 관리를 통해 컨테이너 및 클러스터의 보안을 강화합니다. 잘못된 인증 설정이 시스템에 큰 영향을 줄 수 있으므로 엄격한 인증 절차와 설정이 필요합니다.",
    "설정방법": [
      "Swarm mode 활성화를 불필요하게 하지 않음",
      "관리자 노드의 수를 최소화",
      "자동 잠금 모드를 사용하여 시스템 보안을 강화",
      "Swarm 초기화 시 자동 잠금 모드를 활성화하고, 필요에 따라 잠금키를 주기적으로 변경"
    ]
  },
  "현황": [],
  "진단_결과": ""
}


# Docker Swarm 인증 제어 진단
echo "Docker Swarm 인증 제어 진단을 시작합니다..."

# Swarm mode 활성화 여부 확인
echo "Swarm mode 활성화 여부:"
docker info | grep "Swarm: active"

# 관리자 노드 수 확인
echo "관리자 노드 수:"
docker node ls | grep "Leader" | wc -l

# 자동 잠금 모드 사용 여부 확인
echo "자동 잠금 모드 사용 여부:"
docker swarm unlock-key

# 결과 JSON 출력
echo "{
  \"분류\": \"$분류\",
  \"코드\": \"$코드\",
  \"위험도\": \"$위험도\",
  \"진단_항목\": \"$진단_항목\",
  \"대응방안\": \"$대응방안\",
  \"현황\": $현황,
  \"진단_결과\": \"$진단_결과\"
}"
